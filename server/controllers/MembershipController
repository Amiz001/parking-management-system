const MembershipPlan = require("../models/MembershipModel");

// Get all plans
const getAllPlans = async (req, res, next) => {
    try {
        const plans = await MembershipPlan.find();
        if (!plans || plans.length === 0) {
            return res.status(404).json({ message: "No membership plans found." });
        }
        return res.status(200).json({ plans });
    } catch (err) {
        console.error(err);
        return res.status(500).json({ message: err.message }); // show actual error
    }
};

// Add new plan
const addPlans = async (req, res, next) => {
    const { name, price, description, features, highlight, icon } = req.body;

    try {
        const plan = new MembershipPlan({ name, price, description, features, highlight, icon });
        await plan.save();
        return res.status(201).json({ plan });
    } catch (err) {
        console.error(err);
        return res.status(500).json({ message: err.message });
    }
};

// Get plan by ID
const getById = async (req, res, next) => {
    const id = req.params.id;

    try {
        const plan = await MembershipPlan.findById(id);
        if (!plan) {
            return res.status(404).json({ message: "Plan not found" });
        }
        return res.status(200).json({ plan });
    } catch (err) {
        console.error(err);
        return res.status(500).json({ message: err.message });
    }
};

// Update plan
const updatePlans = async (req, res, next) => {
    const id = req.params.id;
    const { name, price, description, features, highlight, icon } = req.body;

    try {
        const plan = await MembershipPlan.findByIdAndUpdate(
            id,
            { name, price, description, features, highlight, icon },
            { new: true } // returns updated document
        );
        if (!plan) {
            return res.status(404).json({ message: "Unable to update the plan" });
        }
        return res.status(200).json({ plan });
    } catch (err) {
        console.error(err);
        return res.status(500).json({ message: err.message });
    }
};

// Delete plan
const deletePlans = async (req, res, next) => {
    const id = req.params.id;

    try {
        const plan = await MembershipPlan.findByIdAndDelete(id);
        if (!plan) {
            return res.status(404).json({ message: "Unable to delete the plan" });
        }
        return res.status(200).json({ plan });
    } catch (err) {
        console.error(err);
        return res.status(500).json({ message: err.message });
    }
};

module.exports = {
    getAllPlans,
    addPlans,
    getById,
    updatePlans,
    deletePlans
};
